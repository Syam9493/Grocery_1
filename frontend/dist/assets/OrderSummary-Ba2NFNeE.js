import{l as T,aB as U,r as p,i as A,u as J,p as L,j as s,y as B}from"./index-DzasKl2O.js";import{c as _}from"./cartApi-ZyPLVcRe.js";const q=T.injectEndpoints({endpoints:l=>({createOrder:l.mutation({query:a=>({url:`${U}`,method:"POST",body:a})})})}),{useCreateOrderMutation:G}=q,M=({orderForm:l})=>{var x,h,f,j,b,g,y,N,w,I,S,O;const a=["Proceed to Checkout","Proceed to Payment","Confirm Payment"],[r,i]=p.useState(0),[C,k]=p.useState(null),[F]=G();console.log(C);const R=A(t=>{var o;return(o=t.userInfo)==null?void 0:o.user}),D=(()=>{var t;try{const o=localStorage.getItem("persist:root");if(o){const v=JSON.parse(o);if(v.userInfo)return JSON.parse(v.userInfo).user}return((t=JSON.parse(localStorage.getItem("userInfo")))==null?void 0:t.user)||null}catch{return null}})(),d=R||D,u=d==null?void 0:d.id,{data:e}=_(u,{skip:!u}),n=(x=e==null?void 0:e.data)==null?void 0:x.cartItems,E={user:u,shippingAddress:l,orderItems:n,couponDiscount:e==null?void 0:e.data.couponDiscount,subtotal:e==null?void 0:e.data.subtotal,shippingcost:e==null?void 0:e.data.shippingcost,taxes:e==null?void 0:e.data.taxes,total:e==null?void 0:e.data.total,totalItems:e==null?void 0:e.data.totalItems},m=J(),c=L();p.useEffect(()=>{c.pathname==="/checkout"?i(1):c.pathname==="/payment"?i(2):(c.pathname,i(0))},[c.pathname]);const P=async()=>{if(!n||(n==null?void 0:n.length)===0){B.error("Add items to cart before proceeding!");return}if(r===0)m("/checkout");else if(r===1){const t=await F(E).unwrap();k(t._id),m("/payment")}else r===2&&await m("/order-completed")};return s.jsx(s.Fragment,{children:s.jsx("div",{className:"w-full lg:w-2/7",children:(e==null?void 0:e.data)&&s.jsxs("div",{className:"w-full bg-white rounded-lg shadow-md p-5 space-y-4",children:[s.jsx("h2",{className:"text-lg font-semibold border-b pb-2",children:"Order Summary"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Items"}),s.jsx("span",{className:"font-medium",children:((h=e==null?void 0:e.data)==null?void 0:h.totalItems)||0})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Sub Total"}),s.jsxs("span",{className:"font-medium",children:["₹",((j=(f=e==null?void 0:e.data)==null?void 0:f.subtotal)==null?void 0:j.toFixed(2))||"0.00"]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Shipping"}),s.jsxs("span",{className:"font-medium",children:["₹",((g=(b=e==null?void 0:e.data)==null?void 0:b.shippingcost)==null?void 0:g.toFixed(2))||"0.00"]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Taxes"}),s.jsxs("span",{className:"font-medium",children:["₹",((N=(y=e==null?void 0:e.data)==null?void 0:y.taxes)==null?void 0:N.toFixed(2))||"0.00"]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Coupon Discount"}),s.jsxs("span",{className:"text-red-600 font-medium",children:["- ₹",((I=(w=e==null?void 0:e.data)==null?void 0:w.couponDiscount)==null?void 0:I.toFixed(2))||"0.00"]})]})]}),s.jsxs("div",{className:"border-t pt-2 flex justify-between text-base font-semibold",children:[s.jsx("span",{children:"Total"}),s.jsxs("span",{children:["₹",((O=(S=e==null?void 0:e.data)==null?void 0:S.total)==null?void 0:O.toFixed(2))||"0.00"]})]}),s.jsx("button",{className:"w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-2 rounded-full transition duration-200",onClick:P,children:a[r]})]})})})};export{M as O};
