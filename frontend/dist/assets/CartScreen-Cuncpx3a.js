import{h as j,i as y,j as e,x as b,A as N,y as p,r as f,L as w,w as I}from"./index-DzasKl2O.js";import{a as v,b as S,c as C}from"./cartApi-ZyPLVcRe.js";import{L as D,b as k,q as F,F as R,z as q}from"./ExclamationTriangleIcon-C4xMYq5F.js";import{O as E}from"./OrderSummary-Ba2NFNeE.js";import"./vendor-DJG_os-6.js";const J=({open:a,setOpen:c,id:m,refetch:u})=>{const i=j(),[n]=v(),x=y(r=>{var h;return(h=r.userInfo)==null?void 0:h.user}),t=(()=>{var r;try{const h=localStorage.getItem("persist:root");if(h){const g=JSON.parse(h);if(g.userInfo)return JSON.parse(g.userInfo).user}return((r=JSON.parse(localStorage.getItem("userInfo")))==null?void 0:r.user)||null}catch{return null}})(),d=x||t,l=d==null?void 0:d.id,s=async()=>{try{i(b(m)),i(N(m)),p.success("Product added to WishList",{autoClose:1e3,theme:"colored"}),c(!1)}catch(r){console.error("Error adding to wishlist:",r),p.error("Error adding to wishlist!")}},o=async()=>{const r=m;try{await n({userID:l,itemID:r}).unwrap(),p.success("Item removed",{autoClose:1e3,theme:"colored"}),c(!1),await u()}catch(h){console.error("DELETE FAILED:",h),p.error("Error deleting product!",{autoClose:1e3,theme:"colored"})}};return e.jsx(e.Fragment,{children:e.jsxs(D,{open:a,onClose:c,className:"relative z-10",children:[e.jsx(k,{className:"fixed inset-0 bg-black/50"}),e.jsx("div",{className:"fixed inset-0 z-10 w-screen overflow-y-auto",children:e.jsx("div",{className:"flex min-h-full items-center justify-center p-4 text-center",children:e.jsxs(F,{className:"relative transform overflow-hidden rounded-xl bg-white text-left shadow-xl transition-all sm:w-full sm:max-w-lg",children:[e.jsx("div",{className:"bg-white p-6",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(R,{className:"h-10 w-10 text-red-600","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx(q,{as:"h3",className:"text-lg font-medium leading-6 text-gray-900",children:"Remove Item from Cart"}),e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Are you sure you want to remove this item from your cart?"})]})]})}),e.jsxs("div",{className:"bg-gray-50 px-6 py-3 flex justify-end space-x-2",children:[e.jsx("button",{type:"button",onClick:s,className:"inline-flex justify-center rounded-md bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-500",children:"Move to Wishlist"}),e.jsx("button",{type:"button",onClick:o,className:"inline-flex justify-center rounded-md bg-red-600 px-4 py-2 text-sm font-medium text-white hover:bg-red-500",children:"Remove"}),e.jsx("button",{type:"button",onClick:()=>c(!1),className:"inline-flex justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100",children:"Cancel"})]})]})})})]})})},L=({product:a,refetch:c})=>{const m=y(l=>{var s;return(s=l.userInfo)==null?void 0:s.user}),u=(()=>{var l;try{const s=localStorage.getItem("persist:root");if(s){const o=JSON.parse(s);if(o.userInfo)return JSON.parse(o.userInfo).user}return((l=JSON.parse(localStorage.getItem("userInfo")))==null?void 0:l.user)||null}catch{return null}})(),i=m||u,n=i==null?void 0:i.id,[x]=S(),t=async(l,s)=>{const o=String(l);try{await x({userID:n,productID:o,quantity:s}),await c()}catch(r){console.error("Failed to increase quantity:",r)}},d=async(l,s)=>{const o=String(l);try{await x({userID:n,productID:o,quantity:s}),await c()}catch(r){console.error("Failed to decrease quantity:",r)}};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"inline-flex items-center border border-black rounded-full overflow-hidden",children:[e.jsx("button",{className:"px-3 py-1 border-r border-gray-400 text-sm",onClick:()=>d(a._id,a.quantity-1),disabled:a.quantity===1,children:"-"}),e.jsx("h1",{className:"px-4 text-sm",children:a.quantity}),e.jsx("button",{className:"px-3 py-1 border-l border-gray-400 text-sm",onClick:()=>t(a._id,a.quantity+1),children:"+"})]},a._id)})},O=({product:a,refetch:c})=>{const[m,u]=f.useState(!1),[i,n]=f.useState(""),x=t=>{n(t),u(!0)};return e.jsxs(e.Fragment,{children:[a.map(t=>{var d;return e.jsxs("tr",{className:"bg-white rounded-lg shadow-sm mt-4",children:[e.jsxs("td",{className:"flex items-center gap-4 p-4",children:[e.jsx("button",{className:"text-xl text-gray-500 hover:text-red-500",onClick:()=>x(t.productID),children:"x"}),e.jsx("img",{src:(d=t.image)==null?void 0:d[0],alt:t.name,className:"size-16 border border-gray-200 shadow-gray-200 object-contain rounded p-1.5"}),e.jsxs("div",{className:"px-7",children:[e.jsx(w,{to:`/productDetailsPage/${t._id}`,children:e.jsx("p",{className:"font-medium",children:t.name})}),e.jsx("p",{className:"text-sm text-gray-400",children:t.weight})]})]}),e.jsxs("td",{className:"p-4",children:["₹",t.price]}),e.jsx("td",{className:"p-1",children:e.jsx(L,{product:{_id:t.productID,quantity:t.quantity},refetch:c})}),e.jsxs("td",{className:"p-4",children:["₹",t.subtotal.toFixed(2)]})]},t._id)}),e.jsx(J,{open:m,setOpen:u,id:i,refetch:c})]})},H=()=>{var l;const a=j(),c=y(s=>{var o;return(o=s.userInfo)==null?void 0:o.user}),m=(()=>{var s;try{const o=localStorage.getItem("persist:root");if(o){const r=JSON.parse(o);if(r.userInfo)return JSON.parse(r.userInfo).user}return((s=JSON.parse(localStorage.getItem("userInfo")))==null?void 0:s.user)||null}catch{return null}})(),u=c||m,i=u==null?void 0:u.id,{data:n,isSuccess:x,refetch:t}=C(i,{skip:!i}),d=(l=n==null?void 0:n.data)==null?void 0:l.cartItems;return f.useEffect(()=>{x&&n&&a(I(n))},[x,n,a]),e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col lg:flex-row justify-center items-start gap-8 p-4 sm:p-6 md:p-10 md:gap-3 lg:px-14 lg:gap-5",children:[e.jsx("div",{className:"w-full lg:w-2/4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full table-auto text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-yellow-500 text-white",children:[e.jsx("th",{className:"p-4 text-sm sm:text-base",children:"Product"}),e.jsx("th",{className:"p-4 text-sm sm:text-base",children:"Price"}),e.jsx("th",{className:"p-4 text-sm sm:text-base",children:"Quantity"}),e.jsx("th",{className:"p-4 text-sm sm:text-base",children:"Subtotal"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:Array.isArray(d)&&e.jsx(O,{product:d,refetch:t})})]})}),e.jsx(E,{})]})})};export{H as default};
