import{i as K,ay as M,r as q,o as Q,u as V,n as _,j as s,y as o}from"./index-DhnlV0K8.js";import{c as J}from"./cartApi-Dqz5AsWL.js";const W=K.injectEndpoints({endpoints:i=>({createOrder:i.mutation({query:n=>({url:`${M}`,method:"POST",body:n})})})}),{useCreateOrderMutation:X}=W,Y=[{label:"Proceed to Checkout",path:"/checkout"},{label:"Proceed to Payment",path:"/payment"},{label:"Confirm Payment",path:"/order-completed"}],se=({orderForm:i})=>{var p,m,h,x,f,b,j,y,g,N,w,v,C,O,k,I,P,S,A,L,D;const[n,c]=q.useState(0),{userID:l}=Q(),{data:e,isLoading:z}=J(l,{skip:!l}),[B]=X(),a=V(),d=_(),r=((p=e==null?void 0:e.data)==null?void 0:p.cartItems)||[];q.useEffect(()=>{d.pathname.includes("/checkout")?c(1):d.pathname.includes("/payment")?c(2):c(0)},[d.pathname]);const u=t=>{var E,F,T,U,R,$;return t&&((E=t.Firstname)==null?void 0:E.trim())&&((F=t.Lastname)==null?void 0:F.trim())&&((T=t.country)==null?void 0:T.trim())&&((U=t.streetAddress)==null?void 0:U.trim())&&((R=t.city)==null?void 0:R.trim())&&(($=t.zipcode)==null?void 0:$.trim())},G={user:l,shippingAddress:i,orderItems:r,couponDiscount:(m=e==null?void 0:e.data)==null?void 0:m.couponDiscount,subtotal:(h=e==null?void 0:e.data)==null?void 0:h.subtotal,shippingCost:((x=e==null?void 0:e.data)==null?void 0:x.shippingCost)||((f=e==null?void 0:e.data)==null?void 0:f.shippingcost),taxes:(b=e==null?void 0:e.data)==null?void 0:b.taxes,total:(j=e==null?void 0:e.data)==null?void 0:j.total,totalItems:(y=e==null?void 0:e.data)==null?void 0:y.totalItems},H=async()=>{if(!(r!=null&&r.length)){o.error("Add items to cart before proceeding!");return}if(n===0)a("/checkout");else if(n===1){if(!u(i)){o.error("Please fill your shipping address before proceeding!");return}try{await B(G).unwrap(),o.success("Order created successfully!"),a("/payment")}catch(t){console.error("Order creation failed:",t),o.error("Failed to create order!")}}else n===2&&a("/order-completed")};return s.jsx(s.Fragment,{children:z?s.jsx("div",{children:"Loading..."}):s.jsx("div",{className:"w-full lg:w-2/7",children:(e==null?void 0:e.data)&&s.jsxs("div",{className:"w-full bg-white rounded-lg shadow-md p-5 space-y-4",children:[s.jsx("h2",{className:"text-lg font-semibold border-b pb-2",children:"Order Summary"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Items"}),s.jsx("span",{className:"font-medium",children:((g=e==null?void 0:e.data)==null?void 0:g.totalItems)||0})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Sub Total"}),s.jsxs("span",{className:"font-medium",children:["₹",((w=(N=e==null?void 0:e.data)==null?void 0:N.subtotal)==null?void 0:w.toFixed(2))||"0.00"]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Shipping"}),s.jsxs("span",{className:"font-medium",children:["₹",((O=((v=e==null?void 0:e.data)==null?void 0:v.shippingCost)||((C=e==null?void 0:e.data)==null?void 0:C.shippingcost))==null?void 0:O.toFixed(2))||"0.00"]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Taxes"}),s.jsxs("span",{className:"font-medium",children:["₹",((I=(k=e==null?void 0:e.data)==null?void 0:k.taxes)==null?void 0:I.toFixed(2))||"0.00"]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Coupon Discount"}),s.jsxs("span",{className:"text-red-600 font-medium",children:["- ₹",((S=(P=e==null?void 0:e.data)==null?void 0:P.couponDiscount)==null?void 0:S.toFixed(2))||"0.00"]})]})]}),s.jsxs("div",{className:"border-t pt-2 flex justify-between text-base font-semibold",children:[s.jsx("span",{children:"Total"}),s.jsxs("span",{children:["₹",((L=(A=e==null?void 0:e.data)==null?void 0:A.total)==null?void 0:L.toFixed(2))||"0.00"]})]}),s.jsx("button",{className:`w-full ${n===1&&!u(i)?"bg-gray-400 cursor-not-allowed":"bg-green-600 hover:bg-green-700"} text-white font-semibold py-2 rounded-full transition duration-200`,onClick:H,disabled:n===1&&!u(i),children:((D=Y[n])==null?void 0:D.label)||"Proceed"})]})})})};export{se as O};
